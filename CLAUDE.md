# CLAUDE.md — Diet AirDS

This file is read automatically by Claude Code at session startup. It contains project structure, constraints, and pointers to deeper references.

---

## What This Project Is

**Diet AirDS** is a multi-team design system supporting 10 sports organizations. It lives at `https://diet-air-ds.vercel.app` and provides a token-based CSS foundation for building UI components across different team brands with both light and dark mode theming.

The system is intentionally lean: pure CSS tokens + utility classes, no framework dependencies. Components are built by composing existing tokens and classes — never by writing custom CSS from scratch.

The ultimate goal: a perfected CSS system → React/TypeScript component library → Figma Make design system → an AI-driven design agent that makes correct, brand-accurate decisions based entirely on this knowledge base.

---

## Current Focus

- **Complex components** — Building higher-order components from tokens and primitives (beyond buttons, cards, inputs)
- **Usage patterns** — Uploading and codifying real UI examples as reusable component + template patterns; the goal is reducing guesswork for generative coding agents
- **React component library** — Once Figma designs are fully translated to this CSS system, next phase is React/TypeScript optimized as a Figma Make design system
- **Efficiency over perfection** — Sessions are often short. Use prior context and established patterns aggressively. When uncertain about a value, provide a best-guess and flag it rather than blocking.

### Working Principles for This Stage

- Find the closest existing component first and adapt it — don't invent new structure
- Flag degradation risks proactively (e.g. if a new pattern conflicts with established conventions)
- Accuracy on first attempt matters more than speed — the biggest time cost is corrections
- When a Figma spec is ambiguous, state the assumption made and continue rather than asking

---

## The 10 Supported Teams

| `data-theme` value | Team | Button Radius | Notes |
|---|---|---|---|
| `wolves` | Minnesota Timberwolves | 8px | Blue/green |
| `lynx` | Minnesota Lynx | 12px | Blue/green |
| `courage` | NC Courage | 100px (pill) | Red/gold |
| `summit` | Denver Summit FC | 8px | Green/red/yellow |
| `bucknell` | Bucknell Bison | 100px (pill) | Navy/orange |
| `sounders` | Seattle Sounders FC | 100px (pill) | Green/blue/teal |
| `reign` | Seattle Reign FC | 100px (pill) | Purple/gold |
| `ncfc` | NC Football Club | 100px (pill) | Blue/gold |
| `jump` | Jump Default | 100px (pill) | Purple/lime |
| `athletics` | Las Vegas Athletics | 100px (pill) | Green/yellow |

---

## How Theming Works

Two HTML attributes on `<html>` control everything:

```html
<html data-theme="wolves" data-mode="dark">
```

Changing either attribute updates the entire UI automatically via CSS custom properties. Never hardcode colors, fonts, or spacing values.

---

## CSS File Architecture

### Source of Truth

**The local files in this repo are the source of truth.** Edit CSS files directly here and push to `main` — Vercel auto-deploys from the root directory (all root-level `.css`, `.html`, font, and JSON files are served as-is).

The live URL (`https://diet-air-ds.vercel.app/`) reflects what has been deployed. Fetch from there only to verify what's currently live versus what's in local files — never treat it as the edit target.

**Critical exception:** The block between `/* SYNC:START */` and `/* SYNC:END */` in `design-tokens-master.css` is auto-generated by `npm run teams`. Never edit that block manually — it will be overwritten on the next Sanity sync.

### Load Order (Critical — later files depend on earlier ones)

```html
<!-- Google Fonts — always include both -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap" rel="stylesheet">

<!-- Design System — exact order matters -->
<link rel="stylesheet" href="https://diet-air-ds.vercel.app/design-tokens-master.css">
<link rel="stylesheet" href="https://diet-air-ds.vercel.app/spacing-tokens.css">
<link rel="stylesheet" href="https://diet-air-ds.vercel.app/container-tokens.css">
<link rel="stylesheet" href="https://diet-air-ds.vercel.app/border-effects-tokens.css">
<link rel="stylesheet" href="https://diet-air-ds.vercel.app/fonts.css">
<link rel="stylesheet" href="https://diet-air-ds.vercel.app/text-styles-system.css">
<link rel="stylesheet" href="https://diet-air-ds.vercel.app/icons.css">
<link rel="stylesheet" href="https://diet-air-ds.vercel.app/card-components.css">
<link rel="stylesheet" href="https://diet-air-ds.vercel.app/interactive-tokens.css">
<link rel="stylesheet" href="https://diet-air-ds.vercel.app/button-components.css">
<link rel="stylesheet" href="https://diet-air-ds.vercel.app/list-row-components.css">
<link rel="stylesheet" href="https://diet-air-ds.vercel.app/input-components.css">
<link rel="stylesheet" href="https://diet-air-ds.vercel.app/tag-chip-components.css">
<link rel="stylesheet" href="https://diet-air-ds.vercel.app/nav-components.css">
<link rel="stylesheet" href="https://diet-air-ds.vercel.app/boilerplate.css">
```

**In-repo HTML files** use `<script src="ds-loader.js"></script>` (or `../ds-loader.js` from subdirectories) instead of the individual `<link>` tags above. The loader automatically uses local files on localhost/file:// and the Vercel CDN when deployed.

### What Each File Does

| # | File | Purpose |
|---|---|---|
| 1 | `design-tokens-master.css` | Core colors, brand colors per team, semantic tokens |
| 2 | `spacing-tokens.css` | 8px grid spacing scale (`--spacing-25` through `--spacing-1000`) |
| 3 | `container-tokens.css` | Max-width container classes (640px–1600px) |
| 4 | `border-effects-tokens.css` | Border radius, border weight, shadow tokens |
| 5 | `fonts.css` | `@font-face` for all team display fonts (hosted on Vercel) |
| 6 | `text-styles-system.css` | Typography classes (display, title, label, body) |
| 7 | `icons.css` | Material Symbols Rounded icon tokens and utilities |
| 8 | `card-components.css` | Card layout patterns and grid classes |
| 9 | `interactive-tokens.css` | Surface styles (12 types) + scale transforms (3 levels) |
| 10 | `button-components.css` | Button system: 8 types, 3 sizes, icon/circle variants |
| 11 | `list-row-components.css` | List row system: 3-slot architecture + subcomponents |
| 12 | `input-components.css` | Text inputs, select dropdowns, all states |
| 13 | `tag-chip-components.css` | Tag and chip component styles |
| 14 | `nav-components.css` | Top Bar, Tabs, Steps, Page Header |
| 15 | `boilerplate.css` | CSS reset, layout helpers, spacing utilities, grid |

---

## Directory Structure

```
diet-airDS/
├── *.css                     # All CSS source files — edit these directly
├── *.html                    # Demo and walkthrough pages
├── design-tokens-master.css  # Core token file — contains SYNC block (do not manually edit that section)
├── walkthrough.html          # Live token/component reference
├── teams/                    # Per-team JSON configs (auto-generated by npm run teams)
├── fonts/                    # Team display fonts (woff/woff2) — served via Vercel CDN
├── images/                   # Team logos and other images
├── scripts/                  # Sanity sync scripts (Node.js ESM)
├── studio/                   # Sanity Studio — separate app, not part of the CSS system
├── examples/                 # Example pages (checkout, fan-stats, chat, etc.)
└── appendix/                 # Reference docs, old guides — not deployed as components
```

---

## Local Development & Deployment

**No dev server needed.** This is a static system — open any `.html` file directly in a browser to preview.

### Commit & Deploy Policy

Never suggest `git add`, `git commit`, or `git push`. The user manages all commits and Vercel deployments manually. Edit files and flag what changed — stop there.

### Deploy workflow
Edit local files → `git push origin main` → Vercel auto-deploys. Changes to CSS files are live within seconds of deployment.

### Sanity sync
Team brand data (colors, logos, display fonts, button radius) lives in Sanity and syncs to this repo:

```bash
npm run teams   # Fetch all teams from Sanity → writes teams/*.json + updates design-tokens-master.css
```

Requires a `.env` file in the project root:
```
SANITY_PROJECT_ID=your_project_id
SANITY_DATASET=production
```

The sync writes per-team JSON to `teams/` and regenerates the `[data-theme]` CSS blocks in `design-tokens-master.css` between the `SYNC:START` / `SYNC:END` markers.

### Adding new tokens
When the existing scale doesn't cover a needed value:
1. Add the token to the appropriate CSS file (e.g. new spacing → `spacing-tokens.css`)
2. Follow existing naming conventions: `--spacing-[scale]`, `--border-radius-[scale]`, etc.
3. Never hardcode a one-off value inline — always extend the token system
4. Flag any new token names before committing — token names are permanent API surface

---

## Design Token Quick Reference

### Color Tokens — Semantic (Always Use These)

**Backgrounds:**
- `--bg-base` — Main page background
- `--bg-surface` — Cards, elevated surfaces
- `--bg-sheet` — Modals, highest elevation
- `--bg-nav` — Navigation bars (with blur)
- `--bg-input` — Input field background (#FFFFFF light, transparent dark)

**Text:**
- `--text-primary` — Body text (high contrast)
- `--text-secondary` — Supporting text (medium contrast)
- `--text-disabled` — Disabled state
- `--text-placeholder` — Input placeholders

**Brand:**
- `--brand-core` — Primary team color
- `--brand-light` — Secondary team color
- `--brand-dark` — Dark team variant
- `--brand-interactive` — ⚠️ Use this for links, active states, focus rings (mode-aware)
- `--brand-inverted` — Complementary accent color (mode-aware)

**Interactive:**
- `--interactive-primary` / `--interactive-primary-text` — Primary buttons
- `--interactive-transactional` / `--interactive-transactional-text` — Transactional buttons
- `--interactive-secondary-text` — Secondary/outlined button text
- `--interactive-tertiary-text` — Tertiary/ghost button text

**Borders:**
- `--border-default` — Standard borders
- `--border-hover` — Hover state borders
- `--border-active` — Active/focused borders
- `--border-disabled` — Disabled borders

**Status:**
- `--status-success` — Success states (green)
- `--status-warning` — Warning states (amber)
- `--status-error` — Error/destructive states (red)
- `--status-info` — Informational states (blue)

For full spacing, border, container, and typography token reference, see `agent-guide.md`.

---

## Component Systems

All component patterns, code examples, and usage rules are documented in `agent-guide.md`. Components covered: Buttons, Icons, Interactive Surfaces, List Rows, Selector, Event Row, Input Fields, Tile, Cards, Top Bar, Tabs, Steps, Page Header.

---

## Decision Gate

Before writing any custom CSS, check `agent-guide.md §AGENT RULES` for the full decision gate. Summary: reach for an existing component class first — buttons, list rows, inputs, tiles, surfaces, nav, typography. Only write minimal custom CSS when no token or utility applies.

**⚠️ No exemptions — this gate applies to every `.html` file in this repo.** Demos, examples, and internal utility controls are not exempt.

---

## Critical Gotchas

Most gotchas are documented with full examples in `agent-guide.md §TROUBLESHOOTING`. The items below are either unique to this file's context or require emphasis at session startup.

### Safari iOS Font Loading

Safari iOS requires absolute URLs in cross-origin stylesheets. When referencing fonts from a hosted stylesheet, always use the full `https://diet-air-ds.vercel.app/fonts/...` path, not relative paths. Also avoid `font-style: oblique` declarations — Safari interprets these differently than other browsers.

### Spacing Tokens vs. Custom Values

Always extend the token system instead of using custom values. For example, a 2px gap uses `--spacing-25: 2px`, not an inline `gap: 2px`. When a Figma spec doesn't align with the existing scale, add a new token rather than hardcoding.

For all other gotchas (surface tokens vs. text style classes, `--color-interactive` vs `--brand-interactive`, `card-text-pair` vs `list-row-text-pair`, stepper disabled state, switch id/for, list-row padding wrapper, page-header + tabs double border, JS helpers for selects) — see `agent-guide.md §TROUBLESHOOTING`.

---

## Working with Figma

### File Key
The primary Figma file key is `qtyb4i4QNogTd8TJ4F6IMX`.

### Workflow When Analyzing Figma Specs

These are **MCP tool calls** — invoke them directly as tools, not as web fetches.

1. **`get_metadata`** — Ground truth dimensions and node IDs for a frame
2. **`get_design_context`** — Understand structure, tokens, and component relationships
3. **`get_screenshot`** — Visual verification of what was built

### Spacing Priority

When reading Figma specs:
- Prioritize Figma spacing measurements over assumptions
- Map Figma measurements to the nearest token (e.g., 16px → `--spacing-200`)
- If a Figma value doesn't map cleanly to an existing token, say so and ask before extending the system
- Never silently use a hardcoded value when a token doesn't exist — flag the discrepancy

### Name Discrepancies

If a Figma component name doesn't match the CSS class name, always flag it and ask which is correct rather than assuming.

### Known Token Discrepancies (CSS vs Figma) — Do Not "Fix" These

These differences between `design-tokens-master.css` and the Figma "Colors & Modes" variable collection are **intentional or too minor to change**. Do not sync them.

| Token | CSS value | Figma value | Reason — leave as-is |
|---|---|---|---|
| `--border-default` (via `--neutral-200`) | rgba(0,0,0,**0.10**) light / rgba(255,255,255,**0.15**) dark | rgba(0,0,0,**0.20**) light / rgba(255,255,255,**0.25**) dark | **Intentional platform split.** Figma value is calibrated for iOS native borders, which render thinner. Web CSS value (10%/15%) is correct for web. |
| `--text-secondary` (via `--neutral-700`) dark mode | rgba(255,255,255,**0.75**) | Figma `Text/text700` dark = rgba(255,255,255,**0.70**) | Minor 5% opacity delta. Not perceptible in practice. Monitor but do not change. |

All other neutral scale tokens (`--neutral-000` through `--neutral-1000`), inverted scale, and org/brand tokens are in full parity with Figma.

### Component Map — Always Keep Updated

`figma-component-map.md` maps every CSS component class pattern to its Figma COMPONENT_SET counterpart. It is the canonical reference for `figma_instantiate_component` calls — use it to get the correct `nodeId`, variant prop names, and text override keys.

**Keep it updated. Update the map whenever:**
- A new CSS component is built that has a Figma counterpart not yet in the map
- A Figma component's variant prop names or values change
- A component on the "Not yet fully mapped" list gets fully documented
- A "Known Gap" is resolved (CSS class added for a Figma-only component)
- A nodeId changes (rare — only after a Figma file restructure)

**What a complete map entry contains:**
1. Component name, `nodeId`, and type (`COMPONENT_SET`)
2. Table mapping each Figma variant prop → CSS class equivalent
3. Default `figma_instantiate_component` call with correct prop names and values

**File key:** `qtyb4i4QNogTd8TJ4F6IMX` · Components page nodeId: `63:7729`

---

## Backend / CMS

The project uses **Sanity CMS** as a headless backend for team-specific configuration. Webhooks are active and working.

**What Sanity manages:**
- Team logos
- Brand colors (source of truth → syncs to CSS tokens)
- VFS (venue/fan seat view) images
- Venue information
- Team-specific URLs

**Architecture intent:** Sanity is the single source of truth for brand configuration. Changes in Sanity propagate via webhooks to both JSON files and CSS token generation. This avoids manual file editing for team-specific customization.

A custom frontend for Sanity (diet-air-ds-branded admin UI) is under consideration as a future project.

---

## Coding Principles for This Project

1. **Design tokens are the source of truth.** Never hardcode a color, size, or spacing value.
2. **Composability over rigidity.** Build by combining existing tokens and component classes, not creating new CSS from scratch.
3. **Tokens first, custom CSS last.** If something can be done with an existing class, use it. Only write custom CSS when no token or utility exists.
4. **Every component must work across all 10 teams in both modes.** Test wolves/light and athletics/dark as the two extreme cases.
5. **Local files are the source of truth.** Edit CSS here and push to deploy — never treat the Vercel URL as the edit target.
6. **When Figma and token scales conflict, flag it** — don't silently resolve it.
7. **Parent-to-child analysis.** When building new components, examine the full parent template first to understand hierarchy and relationships before building individual pieces.

---

## Key Files in This Repo

| File | Purpose |
|---|---|
| `agent-guide.md` | Complete build reference for AI agents — rules, patterns, examples, master prompt template |
| `text-pairs-guide.md` | Detailed text pair scale reference |
| `inventory-list-row.md` | Spec for the inventory/ticket list row component |
| `confluence-format-example.md` | Required format for any Confluence documentation output |
| `walkthrough.html` | Live interactive token/component reference (also at `https://diet-air-ds.vercel.app/walkthrough.html`) |
| `design-tokens-master.css` | All color tokens — read this to understand the full token shape |
| `figma-component-map.md` | Maps every CSS component to its Figma COMPONENT_SET nodeId, variant props, and `figma_instantiate_component` call syntax — **keep this updated whenever components change** |

---

## Documentation Formatting

When outputting documentation intended for Confluence, follow the syntax and formatting conventions in `confluence-format-example.md` exactly. This is required for proper copy-paste compatibility.
